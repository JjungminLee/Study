# 데이터 모델과 질의 언어

## 데이터 모델

- 해결하려는 문제를 어떻게 생각해야 하는지에 대해서도 지대한 영향을 미친다

## 관계형 모델

- 관계로 구성되고 각 관계는 순서 없는 튜플의 모음
- NoSQL
  - 대규모 데이터셋이나 매우 높은 쓰기 처리량
  - 관계형 모델에서 지원하지 않는 특수 질의 동작 (관계형 모델의 제한에 대해 더 동적으로 대응)

## 문서 모델

- 몽고DB, 리싱크 DB, 카우치 DB
- Json 채택
  - 다중 테이블 스키마보다 더 나은 지역성을 갖는다
  - 관계형에서 프로필 가져오려면 다중질의, 다중 조인을 수행해야함
  - Json 표현은 모든 관련 정보가 한 곳에 있어 질의 하나로 충분
  - 사용자 프로필에서 직위,할결,연락처 정보로 대응되는 일대다 관계는
    - 트리구조와 같음!
- 다대일과 다대다
  - 중복제거를 하기 위해 데이터를 정규화할 때는 다대일 관계가 필요한데
    - 다대일 관계는 문서 모델에 적합하지 않다
  - 문서 모델은 join을 지원하지 않음
    - 다중 질의를 만들어서 애플리케이션 코드에서 조인을 흉내내야 한다

## 관계형 데이터 모델 vs 문서 데이터 모델

### 관계형 데이터 베이스 (SQQL)

- 조인, 다대일, 다대다 관계 지원

### 문서 데이터 베이스 (NoSQL)

- 스키마 유연성, 지역성에 기인한 더 나은 성능
- 애플리케이션에서 데이터가 문서와 비슷한 구조 (일대다 관계 트리로 보통 한번에 전체 트리 적재)
  - 이때는 문서 모델을 사용하는 것이 좋다!
- 문서가 깊이 중첩되지 않으면 된다
- 미흡한 조인 지원은 it depends on!
  - 이벤트를 기록하는 문서 데이터베이스를 사용하는 분석 애플리케이션에서는 다대다 관계가 필요하지 않음
- schemaless
  - 오해의 소지가 있음
    - 데이터를 읽는 코드는 보통 구조의 유형을 어느정도 가정
    - 쓰기 스키마
      - 스키마는 명시적이고 데이터 베이스는 쓰여진 모든 데이터가 스키마를 따르고 있음을 보장
      - 런타임 타입 확인과 유사
    - 읽기 스키마
      - 데이터 구조는 암묵적이고 데이터를 읽을때만 해석된다
      - 정적타입 확인과 유사
- 저장소 지역성
  - 자주 전체문서에 접근해야할 때 저장소 지역성을 활용하면 성능 이점이 있다
  - 문서를 아주 작게 유지하면서 문서의 크기가 증가하는 쓰기는 피해야한다
- 질의
  - 명령형 질의
  - 선언형 질의
    - 명령형보다 더 간결하고 쉽게 작업가능
    - 데이터베이스 엔진의 상세구현이 숨겨짐
    - 병렬 실행에 적합
  - 맵리듀스 질의
    - 읽기전용 질의에 적합

## 그래프형 데이터모델 (NoSQL)

- 다대다 관계일경우 사용
- 사이퍼 질의
  - 속성 그래프를 이용한 선언형 질의 언어
- 그래프 데이터를 관계형 구조로 넣어도 SQL을 사용해 질의할 수 있을까?
  - 가능하지만 비추천 사이퍼 질의로 4줄 만들거 SQL로 29줄나옴..

## Recap

- 문서 데이터베이스
  - 데이터가 문서 자체에 포함돼 있으면서 하나의 문서와 다른 문서간 관계가 거의 없는 사용 사례를 대상으로 한다.
- 그래프 데이터베이스
  - 문서 데이터베이스와는 정반대로 모든것이 잠재적으로 관련돼있다는 사용사례를 대상으로 한다.
