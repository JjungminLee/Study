## MySQL의 성능을 제한하는 요소

- 흔한 현상은 CPU고갈
  - 병렬로 너무 많은 쿼리를 실행하려고 함
  - 쿼리가 너무 오랫동안 실행됨
-

### 어떤 CPU를 선택하지?

- 서버의 두가지 목표
  - 빠른 응답시간
  - 높은 처리량
- 워크로드가 모든 CPU를 활용하지 않는 경우
  - InnoDB버퍼 삭제, 네트워크 작업같은 백그라운드 작업에 추가적인 CPU사용 가능

### 읽기,쓰기 캐싱

- 모든 데이터가 메모리에 있는 경우 -> 서버의 캐시가 준비되면 캐시히트
- 캐시는 쓰기를 지연시킬수 있지만 배제할 수 있다.
  - 다수의 쓰기,한번의 플러시
    - 모든 새로운 값을 디스크에 기록하지 않고도 메모리에서 여러번 변경
  - I/O 병합
- 쓰기는 랜덤I/O를 순차적인 I/O로 변환하기 때문에 버퍼링의 이점이 크다
  - 디스크에 데이터를 쓰는 과정에서 **작은 크기의 랜덤한 쓰기 요청들이 여러 개 발생**하면, 일반적으로 디스크가 여러 위치를 오가며 데이터를 기록해야 하므로 **랜덤 I/O가 발생**.
  - 하지만, OS는 **버퍼 캐시(Buffer Cache)** 또는 **페이지 캐시(Page Cache)**를 사용해서 여러 개의 작은 쓰기 요청을 모아 **큰 블록 단위로 순차적으로 기록하는 방식으로 변환**할 수 있음.

### 네트워크 설정

- MySQL은 연결 요처을 받으면 정방향, 역방향 DNS조회를 실행한다.
  - 여기서 문제가 생기면 연결이 거부되고 서버 연결 프로세스가 느려지며 서비스 거부 공격을 포함하여 큰 피해를 입게 된다.
  - 사용자 계정의 호스트 열에 IP주소, 로컬호스트 또는 IP주소 와일드카드만 있어야하는 이유

### 어떤 파일 시스템을 선택해야할까?

- ext4,XFS또는 ZFS같은 저널링 파일시스템을 사용하는 것이 좋다
- 엑세스 시간을 기록하는 건 절대 하면 안된다!

## Recap

- MySQL에 필요한 4가지 기본 리소스
  - CPU,메모리,디스크,네트워크 리소스
  - 메모리와 디스크는 병목현상이 자주 일어난다
  - 동시성이 높을수록 더 많은 CPU필요
- 단순히 I/O바운드라고 해서 더 많은 I/O용량이 필요한건 아니다.
  - 어떤 쿼리가 더 많이 실행되느냐에 따라 I/O용량이 필요할 수도 있고, 더 많은 메모리가 필요할 수도 있다.
