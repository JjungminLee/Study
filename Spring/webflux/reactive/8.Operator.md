https://gnidinger.tistory.com/entry/WebFlux%EC%9E%90%EC%A3%BC-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-%EC%97%B0%EC%82%B0%EC%9E%90-%EC%A0%95%EB%A6%AC3-%EA%B7%B8%EB%A6%AC%EA%B3%A0

## Map

- ìŠ¤íŠ¸ë¦¼ì˜ ê° ìš”ì†Œë¥¼ ìƒˆë¡œìš´ ìš”ì†Œë¡œ ë³€í™˜
- ì´ê²ƒì„ ì €ê²ƒìœ¼ë¡œ ë°”ê¾¸ëŠ” í•¨ìˆ˜í˜• ë„êµ¬

```
public Flux<String> namesFluxMap(){
   return Flux.fromIterable(List.of("a","b","c"))
      .map(String::toUpperCase)
      .log();
}
```

## ë°˜ì‘í˜• ìŠ¤íŠ¸ë¦¼ì˜ ë¶ˆë³€ì„±

```

void namesFluxMap() {
   var namesFlux =  Flux.fromIterable(List.of("a","b","c")
   namesFlux.map(String::toUpperCase);
}
```

- namesFluxëŠ” ëŒ€ë¬¸ìë¡œ ë³€í™˜ë˜ì§€ ì•ŠëŠ”ë‹¤!
- immutable!

## Filter

- ì›ì†Œë¥¼ ê±¸ëŸ¬ë‚´ëŠ”
- ì¡°ê±´ê³¼ ì¼ì¹˜í•˜ëŠ” ìš”ì†Œë§Œ í¬í•¨

```
public Flux<String> namesFluxMap(int stringLength){
   return Flux.fromIterable(List.of("a","b","c"))
      .map(String::toUpperCase)
      .filter(s->s.length()>stringLength)
      .log();
}
```

## flatMap in Flux

- 'ì´ê²ƒ'ì˜ ìŠ¤íŠ¸ë¦¼ì„ ë‹¤ë¥¸ í¬ê¸°ë¡œ ëœ 'ì €ê²ƒ'ì˜ ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ë°”ê¾¼ë‹¤
- 2ì°¨ì› ë°°ì—´ì„ ëª¨ë“  ì›ì†Œë¥¼ í¬í•¨í•˜ëŠ” ë‹¨ì¼ ì›ì†Œì˜ ë°°ì—´ë¡œ ë°”ê¾¸ëŠ” ì˜ˆì‹œ

```
public Flux<String> namesFluxMap(int stringLength){
   return Flux.fromIterable(List.of("alex","bob","chloe"))
      .map(String::toUpperCase)
      .filter(s->s.length()>stringLength)
      .flatMap(s->splitString(s))    // ALEX ->  A,L,E,X
      .log();
}
public Flux<String> splitString(String name){
   var charArray = name.split("");
   return Flux.fromArray(charArray);
}
```

### flatMapì„ ì´ìš©í•œ ë¹„ë™ê¸° ì—°ì‚°

```
public Flux<String> splitString(String name){
   var charArray = name.split("");
   return Flux.fromArray(charArray)
      .delayElements(Duration.ofMillis(1000));
}
```

- delayElements ì—°ì‚°ìë¥¼ ë„£ì–´ì¤€ë‹¤

```
@Test
void namesFluxMap() {
   var namesFlux = fluxAndMonoGeneratorService.namesFluxMap(3);
   StepVerifier.create(namesFlux)
      .expectNext("A","L","E","X","C","H","L","O","E")
      .verifyComplete();

}
```

- chloeì—ì„œ ë¹„ë™ê¸° ì—°ì‚°ë•Œë¬¸ì— ë°ì´í„°ê°€ ì œëŒ€ë¡œ ì•ˆë³€í™˜ë ìˆ˜ ìˆìŒ
- ì´ëŸ´ë•ŒëŠ” expectCountì´ìš©í•´ì„œ ë°ì´í„° ì „ë¶€ë‹¤ ë°›ì„ ìˆ˜ ìˆê²Œ!
  - ê²°ê³¼ëŠ” chloe -> Alexìˆœì„œë¡œ ì¶œë ¥

## concatMap in Flux

- flatMapê³¼ ìœ ì‚¬
- ì—…ìŠ¤íŠ¸ë¦¼ ì´ë²¤íŠ¸ì˜ ìˆœì„œë¥¼ ìœ ì§€í•˜ë©° ì¤‘ì²©ì„ í”¼í•˜ëŠ” ê¸°ëŠ¥
- ë™ì‹œì„± ì²˜ë¦¬ë¥¼ ëŒì–´ë“œë¦¬ì§€ ì•ŠëŠ”ë‹¤!

```
    public Flux<String> namesFluxMap(int stringLength){
      return Flux.fromIterable(List.of("alex","bob","chloe"))
         .map(String::toUpperCase)
         .filter(s->s.length()>stringLength)
         .concatMap(s->splitString(s))    // ALEX ->  A,L,E,X
         .log();
   }
```

- ì•„ê¹ŒëŠ” chloe->Alexìˆœì„œë¡œ ì¶œë ¥ì´ì˜€ë‹¤ë©´ ì–˜ëŠ” Alex->Chloeë¡œ ì¶œë ¥ë˜ë©´ì„œ
  - ìˆœì„œë¥¼ ë³´ì¥í•œë‹¤.
  - ëŒ€ì‹  ì‹œê°„ì„ ì¢€ ì¡ì•„ë¨¹ìŒ

## flatMap in Mono

- ì—”í„°í”„ë ˆì´ì¦ˆ ì•±ì„ ë§Œë“ ë‹¤ë©´ FlatMapì„ ì‚¬ìš©í•´ë¼
  - ### **`flatMap()`ì€ ë¹„ë™ê¸° HTTP í˜¸ì¶œì„ ë³‘ë ¬ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŒ**
  - WebFlux(WebClient)ì™€ ê°™ì€ **ë¹„ë™ê¸° HTTP í˜¸ì¶œ**ì„ ì‚¬ìš©í•  ë•Œ, `flatMap()`ì„ í™œìš©í•˜ë©´ **ë™ì‹œì— ì—¬ëŸ¬ ê°œì˜ HTTP ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆìŒ**.

```
public Mono<List<String>> namesMonFlatMap(int stringLength){
   return Mono.just("alex")
      .map(String::toUpperCase)
      .filter(s->s.length() > stringLength)
      .flatMap(this::splitStringMono)
      ;
}
private Mono<List<String>> splitStringMono(String s){
     var charArray = s.split("");
     var charList = List.of(charArray);   // ALEX -> A,L,E,X
     return  Mono.just(charList);
}
```

## flatMapMany()

- Monoë¥¼ ë°›ì•„ Fluxë¥¼ ë°˜í™˜í•˜ëŠ” ì—°ì‚°ì

```
public Flux<String> namesMonFlatMap(int stringLength){
   return Mono.just("alex")
      .map(String::toUpperCase)
      .filter(s->s.length() > stringLength)
      .flatMapMany(this::splitString)
      .log()
      ;
}

@Test
void namesMonFlatMap() {
   var namesMono = fluxAndMonoGeneratorService.namesMonFlatMap(3);
   StepVerifier.create(namesMono)
      .expectNext("A","L","E","X")
      .verifyComplete();
}
```

## Transform

- ë°ì´í„° ìŠ¤íŠ¸ë¦¼ ë³€í™˜í•˜ê±°ë‚˜ ì¡°ì‘

### Function ì¸í„°í˜ì´ìŠ¤

```
name.map(String::toUpperCase)
   .filter(s->s.length() > stringLength);
```

-> ì´ë ‡ê²Œ ë°˜ë³µë˜ëŠ” ë¡œì§ì„ ë³€ìˆ˜í™”í•  ìˆ˜ ìˆë‹¤!

```
Function<Flux<String>,Flux<String>> fitlerMap = name -> name.map(String::toUpperCase)
   .filter(s->s.length() > stringLength);
```

```
Function<Flux<String>,Flux<String>> fitlerMap = name -> name.map(String::toUpperCase)
   .filter(s->s.length() > stringLength);
return Flux.fromIterable(List.of("alex","ben","chloe"))
   .transform(fitlerMap)
   .flatMap(s->splitString(s))
   .log()
   ;
```

`transform()`ì€ **ì—°ì‚°ì ì²´ì¸ ì „ì²´ë¥¼ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜í˜• ì—°ì‚°ì**ì…ë‹ˆë‹¤.  
ì¦‰, **Flux ë˜ëŠ” Monoì˜ íë¦„ì„ í•œ ë²ˆì— ë³€ê²½í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤ë‹ˆë‹¤.**  
íŠ¹ì • `Flux`ë‚˜ `Mono`ì˜ ì „ì²´ ë™ì‘ì„ ë³€ê²½í•  ë•Œ ìœ ìš©í•©ë‹ˆë‹¤.

## defaultIfEmpty, switchIfEmpty

- deafult
  - ì›ë³¸ `Flux` ë˜ëŠ” `Mono`ê°€ **ë¹ˆ ìƒíƒœ(empty)ì¼ ê²½ìš°, ê¸°ë³¸ê°’ì„ ë°˜í™˜**.
  - ë‹¨ìˆœíˆ **í•˜ë‚˜ì˜ ê°’ìœ¼ë¡œ ëŒ€ì²´**.
  - ë§Œì¡±í•˜ëŠ”ê²Œ ì—†ë‹¤ë©´ ì—ëŸ¬ë¥¼ ë˜ì§€ë‹ˆê¹Œ ë””í´íŠ¸ë¡œ ë˜ì ¸ì£¼ëŠ”ê±°

```
Function<Flux<String>,Flux<String>> fitlerMap = name -> name.map(String::toUpperCase)
   .filter(s->s.length() > stringLength);
return Flux.fromIterable(List.of("alex","ben","chloe"))
   .transform(fitlerMap)
   .flatMap(s->splitString(s))
   .defaultIfEmpty("default")
   .log()
   ;
```

- switch
  - ë³¸ `Flux` ë˜ëŠ” `Mono`ê°€ **ë¹„ì–´ìˆì„ ê²½ìš°, ë‹¤ë¥¸ `Publisher`ë¡œ ë³€ê²½**.
  - ì¦‰, **ëŒ€ì²´ `Flux` ë˜ëŠ” `Mono`ë¥¼ ì‹¤í–‰**.

```
Function<Flux<String>,Flux<String>> fitlerMap = name -> name.map(String::toUpperCase)
   .filter(s->s.length() > stringLength).flatMap(s->splitString(s));
var defaultFlux = Flux.just("default")
   .transform(fitlerMap);
return Flux.fromIterable(List.of("alex","ben","chloe"))
   .transform(fitlerMap)
   .switchIfEmpty(defaultFlux)
   .log()
   ;
```

## concat, concatWith

- ë‘ê°œì˜ ë¦¬ì—‘í‹°ë¸Œ ìŠ¤íŠ¸ë¦¼ì„ í•˜ë‚˜ë¡œ!
- concat
  - fluxì˜ static method
  - ì—¬ëŸ¬ ê°œì˜ `Flux` ë˜ëŠ” `Mono`ë¥¼ **ìˆœì„œëŒ€ë¡œ ì—°ê²°í•˜ì—¬ ì‹¤í–‰**.
  - **ì…ë ¥ê°’ìœ¼ë¡œ `Publisher<T>`(Flux ë˜ëŠ” Mono)ë¥¼ ì—¬ëŸ¬ ê°œ ë°›ì„ ìˆ˜ ìˆìŒ**.
  - **ëª¨ë“  ìŠ¤íŠ¸ë¦¼ì„ í•œ ë²ˆì— ë¬¶ì–´ì„œ ì‹¤í–‰**.
- concatWith
  - Fluxì™€ Monoì˜ instance method
  - **ê¸°ì¡´ Flux ë˜ëŠ” Monoì— ìƒˆë¡œìš´ `Publisher`ë¥¼ ì¶”ê°€**í•˜ëŠ” ë°©ì‹.
-

```
public Flux<String> exploreConcat(){
   var abcFlux = Flux.just("a","b","c");
   var defFlux = Flux.just("d","e","f");
   return Flux.concat(abcFlux,defFlux).log();
}
```

```
public Flux<String> exploreConcatMono(){
   var abcFlux = Flux.just("a","b","c").delayElements(Duration.ofMillis(1000));
   var defFlux = Flux.just("d","e","f").delayElements(Duration.ofMillis(1000));
   return abcFlux.concatWith(defFlux).log();
}
```

## merge, mergeWith

- ë‘ê°œì˜ publisherë¥¼ í•˜ë‚˜ë¡œ ì—°ê²°
- **`merge()`** â†’ **Fluxë“¤ì„ ë³‘ë ¬ë¡œ ì‹¤í–‰ (ìˆœì„œ ìœ ì§€ X)**
- **`concat()`** â†’ **Fluxë“¤ì„ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰ (ìˆœì„œ ìœ ì§€ O)**
  **ë¹„ë™ê¸° ì‘ì—…(ë³‘ë ¬ ì²˜ë¦¬)ì´ í•„ìš”í•˜ë©´ `merge()`**, **ìˆœì„œ ë³´ì¥ì´ í•„ìš”í•˜ë©´ `concat()` ì‚¬ìš©!**

```
var abcFlux = Flux.just("a","b","c").delayElements(Duration.ofMillis(1000));
var defFlux = Flux.just("d","e","f").delayElements(Duration.ofMillis(1000));;
return Flux.merge(abcFlux,defFlux).log();
```

- concatì—ì„œëŠ” íŒŒë€ë¶ˆì´ë˜ í…ŒìŠ¤íŠ¸ì¼€ì´ìŠ¤ê°€ mergeì“°ë©´ ìˆœì°¨ì  ì‹¤í–‰ì´ ì•ˆë¼ì„œ ë¹¨ê°„ë¶ˆ!

## mergeSequential

```
var abcFlux = Flux.just("a","b","c").delayElements(Duration.ofMillis(1000));
var defFlux = Flux.just("d","e","f").delayElements(Duration.ofMillis(1000));;
return Flux.mergeSequential(abcFlux,defFlux).log();
```

- ë³‘ë ¬ë¡œ ì‹¤í–‰í•˜ë©´ì„œë„ ìˆœì„œë¥¼ ì§€í‚¨ë‹¤!

## zip,zipWith

- zip

```
public Flux<String> exploreZip(){
   var abcFlux = Flux.just("a","b","c");
   var defFlux = Flux.just("d","e","f");
   return Flux.zip(abcFlux,defFlux,(first,second)->first+second);

}
```

- zipWith

```
public Flux<String> exploreZip(){
   var abcFlux = Flux.just("a","b","c");
   var defFlux = Flux.just("d","e","f");
   return abcFlux.zipWith(defFlux,(first,second)->first+second).log();

}
```

## âœ… **1. `zip()`**

ğŸ“Œ **ê¸°ëŠ¥**

- **ë‘ ê°œ ì´ìƒì˜ `Flux` ë˜ëŠ” `Mono`ë¥¼ ê²°í•©í•˜ì—¬ íŠœí”Œ(`Tuple2`, `Tuple3`...)ë¡œ ë°©ì¶œ**.

## âœ… **2. `zipWith()`**

ğŸ“Œ **ê¸°ëŠ¥**

- `zip()`ê³¼ ìœ ì‚¬í•˜ì§€ë§Œ, **ì²´ì´ë‹ ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©** ê°€ëŠ¥.
- **í˜„ì¬ `Flux` ë˜ëŠ” `Mono`ì— ì¶”ê°€ì ìœ¼ë¡œ ë‹¤ë¥¸ `Flux`ë¥¼ ê²°í•©**

## Recap

| ì—°ì‚°ì         | ì‹¤í–‰ ë°©ì‹ | ìˆœì„œ ë³´ì¥                                 | ë™ì‘ ë°©ì‹                                    |
| -------------- | --------- | ----------------------------------------- | -------------------------------------------- |
| **`zip()`**    | ë³‘ë ¬ ì‹¤í–‰ | âŒ ìˆœì„œ ë³´ì¥ ì•ˆë¨ (ê° ìš”ì†Œë¥¼ ë¬¶ì–´ì„œ ì¡°í•©) | ê° `Flux`ì˜ ê°™ì€ ì¸ë±ìŠ¤ ë°ì´í„°ë“¤ì„ ë¬¶ì–´ ë³€í˜• |
| **`concat()`** | ìˆœì°¨ ì‹¤í–‰ | âœ… ìˆœì„œ ë³´ì¥                              | ì• `Flux`ê°€ ëë‚˜ì•¼ ë‹¤ìŒ `Flux` ì‹¤í–‰          |
| **`merge()`**  | ë³‘ë ¬ ì‹¤í–‰ | âŒ ìˆœì„œ ë³´ì¥ ì•ˆë¨                         | ì—¬ëŸ¬ ê°œì˜ `Flux`ë¥¼ ë™ì‹œì— ì‹¤í–‰               |
