## 빈 생명주기 콜백

- 데이터베이스 커넥션 풀 (미리 연결해서 잡아놓음), 네트워크 소켓처럼 애플리케이션 시작 시점에 필요한 연결을 미리 해두고, 애플리케이션 종 시점에 연결을 모두 종료하는 작업을 진행하려면 객체의 초기화와 종료 작업이 필요하다
- 스프링을 통해 초기화 작업과 종료 작업을 어떻게 진행하는지 알아보기!

## 스프링 빈의 라이프 사이클

- 객체 생성 -> 의존관계 주입
- 스프링 빈은 객체가 다 생성되고, 의존관계 주입이 다 끝난 다음에야 필요한 데이터 사용할 수 있는 준비가 끝남
- 개발자가 의존관계 주입이 완료된 시점을 어떻게 알지?
  - 스프링은 의존관계 주입이 완료되면 스프링 빈에게 콜백메서드를 통해 초기화 시점을 알려주는 다양한 기능을 제공.
  - 스프링 컨테이너가 종료되기 직전에 소멸 콜백을 준다.
- 스프링 빈의 이벤트 라이프 사이클
  - 스프링 컨테이너 생성 -> 스프링 빈 생성 -> 의존관계 주입 -> 초기화 콜백 -> 사용 -> 소멸 전 콜백 -> 스프링 종료
- 초기화 콜백 : 빈이 생성되고, 의존관계 주입이 끝난 후 호출

### 객체의 생성과 초기화를 분리해야하는 이유

- 생성자는 필수 정보 받고 -> 메모리 할당해서 -> 객체 생성하는 책임
- 초기화는 생성된 값들 활용해 외부 커넥션 연결하는 등 무거운 동작 실행
- 유지보수 관점에서 생성과 초기화를 분리하는 것이 좋다!

## 스프링 빈의 3가지 생명주기 콜백

- 인터페이스(Initializing Bean, Disposable Bean)
- 설정 정보에 초기화 메서드, 종료 메서드 지정
- @PostConstruct @PreConstruct 에노테이션 지정

## 인터페이스(Initializing Bean, Disposable Bean)

- 왜 쓰는가?
  - 스프링 빈의 초기화 단계에서 특정 로직을 실행하기 위함
- 언제 쓰는가?
  - 커넥션 풀 초기화
  - 외부 리소스 연결 설정
- 초기화, 소멸 인터페이스의 단점
  - 스프링 전용 인터페이스에 의존
  - 초기화, 소멸 메서드의 이름 변경 불가
- 거의 사용 안함

## 빈 등록 초기화, 소멸 메서드

- 소멸 메서드
  - 기본값이 추론

```
@Configuration
static class LifeCycleConfig{


    @Bean(initMethod = "init",destroyMethod = "close")
    public NetworkClient networkClient(){
        NetworkClient networkClient = new NetworkClient();
        networkClient.setUrl("http://hello");
        return networkClient;
    }
}
```

## 애노테이션 @PostConstruct, @PreDestroy

- jakarta.

  - Jakarta EE는 웹 애플리케이션, 엔터프라이즈 애플리케이션 등을 구축하기 위한 다양한 API와 런타임 환경을 제공합니다. 여기에는 서블릿, EJB, JPA, CDI 등 많은 자바 기술이 포함

- 이걸 이용하셈
- 코드를 고칠 수 없는 외부 라이브러리 초기화, 종료해야하면 @Bean의 initMethod, destroyMethod사용하기!

## 빈 스코프

- 빈이 존재할 수 있는 범위
- 웹 관련 스코프
  - request : 웹 요청이 들어오고 나갈때까지 유지되는 스코프
  - session : 세션이 생성되고 종료될때까지 유지되는 스코프
  - application : 웹의 서블릿 컨텍스와 같은 범위로 유지되는 스코프

## 프로토타입 스코프

- 프로토타입 스코프의 빈을 스프링 컨테이너에 요청
- 스프링 컨테이너는 이 시점에 프로토타입 빈 생성 후, 의존관계 주입.
- 스프링 컨테이너는 생성한 프로토타입 빈을 클라이언트에 반환.
- 스프링 컨테이너는 같은 요청이 오면 항상 새로운 프로토타입 빈을 생성후 반환.
- 프로토타입 빈을 관리할 책임은 프로토타입 빈을 받은 클라이언트에 있다!
- @PreDestroy같은 종료 메서드가 호출되지 않는다.

## 프로토타입 스코프와 싱글톤 빈 같이 사용했을 때 문제점

- **인스턴스 수**:
  - **싱글톤**: 컨테이너당 하나의 인스턴스.
  - **프로토타입**: 요청 시마다 새로운 인스턴스 생성.
- **생명주기 관리**:
  - **싱글톤**: 스프링이 빈 생성부터 소멸까지 전체 생명주기를 관리.
  - **프로토타입**: 초기화까지만 스프링이 관리하며, 소멸은 개발자가 직접 처리.
- **상태 공유**:

  - **싱글톤**: 여러 컴포넌트에서 동일 인스턴스를 공유하므로 상태 변화가 전파될 수 있음.
  - **프로토타입**: 각 요청마다 새로운 인스턴스이기 때문에 상태 공유가 발생하지 않음

- 문제점
  - 프로토타입 빈을 주입 시점에만 새로 생성하는 것이 아니라, 사용할때마다 새로 생성하는 것을 원할것 .

## Provider로 해결하기!

## 웹 스코프

- 프로토타입과 다르게 스프링이 해당 스코프의 종료시점까지 관리된다!
